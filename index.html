<!DOCTYPE html>
<html>

<head>
  <title>Straighten Up</title>
  <link rel="stylesheet" href="/style.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark" style="background-color:#2b2e4a;">
    <div class="container">
      <a class="navbar-brand" style="font-size:25px;color: #ee7777" href="#">Straighten Up</a>
      <button style="border-style:none;" class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon">
        </span>
      </button>
      <div class="collapse justify-content-end navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-link" href="#machine">Machine</a>
          <a class="nav-link" href="#">What</a>
          <a class="nav-link" href="#">Why</a>
          <a class="nav-link" href="#">Resources</a>
        </div>
      </div>
    </div>
  </nav>
  <div style="height:100px"></div>

  <div id="machine" class="container">
    <h1 style="font-size:50px;">Straighten Up</h1>
    <p>This is our MoCoHacks 2021 project</p>
    <p>Maxwell Ye, Tyson Fang, Isaac Yebio</p>
    <div class="row">
      <div class="d-flex align-items-center col-md-6">
        <div>
          <h3>The Optimal Posture</h3>
          <p>Assuming that the user is using a computer and sitting at a table...</p>
          <ul>
            <li>20+ in between screen and user's eyes</li>
            <li>Computer is directly in front of the user</li>
            <li>Center of monitor is 15-20 degrees below horizontal eye level</li>
          </ul>
          <h3>Instructions</h3>
          <ol>
            <li>Align head to be in between the aquamarine lines.</li>
            <li>Align nose to rest on pink line.</li>
          </ol>
        </div>
      </div>
      <div class="col-md-6" style="background-color:red;padding-right:12px;padding-left:12px">
        <h3 style="text-align:center;">Teachable Machine Model</h3>

        <button class="tmbtn" onclick="init();loopstarter()">Start</button>
        <button class="tmbtn" onclick="loopstopper()">Stop</button>
        <!--<button id="stopBtn" type="button" onclick="">Stop</button>-->
        <div class="text-center" style="background-color:blue;height:200px;">
          <div class="row" style="width:100%;">
            <div class="col-12" style="background-color:blanchedalmond">
              <canvas style="height:200px; width:200px;" id="canvas"></canvas>
            </div>

            <div class="col-0" style="height:200px;width:0px;position:relative;padding-left:0px;padding-right:0px;">
              <div style="background-color:aquamarine;height:5px;position:relative;top:67px;right:200px;width:200px;"></div>
              <div style="background-color:violet;height:5px;position:relative;top:133px;right:200px;width:200px;"></div>
              <div style="background-color:aquamarine;height:5px;position:relative;top:160px;right:200px;width:200px"></div>
            </div>
          </div>
        </div>
        <div style="height:100px;" id="label-container"></div>
      </div>
    </div>


  </div>

  <div class="container">
    <h1>Reaching New Heights</h1>
    <p>The term posture is in reference to the position of oneâ€™s body in a standing or sitting position. The spine
      consists of three natural curvatures which when aligned evenly distributes the weight between your feet. Good
      posture distributes this weight to prevent lopsidedness.</p>
    <p>- Nourishing proper posture form can</p>
    <ol>
      <li>Prevent stress from building on your spinal chords</li>
      <li>Decrease back pains and aches</li>
      <li>Servicable to aging</li>
      <li>Decrease the likelihood of headaches</li>
      <li>Improve oxygen flow</li>
    </ol>
    <p>As video meetings become more prevalent during this day and age, your virtual image becomes very important.
      Along
      with the various health benefits associated with good posture, this website will also assist your image on
      professional meetings online.
    </p>
  </div>

  <div id="resources" class="container">
    <h1>Resources</h1>
    <a
      href="https://www.osha.gov/SLTC/etools/computerworkstations/components_monitors.html#:~:text=Generally%2C%20the%20preferred%20viewing%20distance,the%20monitor%20(table%20depth)">United
      States Department of Labor</a>
    <a href="https://teachablemachine.withgoogle.com/">Teachable Machine</a>
    <a href="https://getbootstrap.com/">Bootstrap</a>
  </div>






  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
  <script type="text/javascript">
    // More API functions here:
    // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/pose
    let loopstop = false;
    function loopstopper() {
      loopstop = true;
    }
    function loopstarter() {
      loopstop = false;
    }
    // the link to your model provided by Teachable Machine export panel
    const URL = "/my-pose-model/";
    let model, webcam, ctx, labelContainer, maxPredictions;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      // load the model and metadata
      // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
      // Note: the pose library adds a tmPose object to your window (window.tmPose)
      model = await tmPose.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      // Convenience function to setup a webcam
      const size = 200;
      const flip = true; // whether to flip the webcam
      webcam = new tmPose.Webcam(size, size, flip); // width, height, flip

      await webcam.setup(); // request access to the webcam
      await webcam.play();
      window.requestAnimationFrame(loop);

      // append/get elements to the DOM
      const canvas = document.getElementById("canvas");
      canvas.width = size; canvas.height = size;
      ctx = canvas.getContext("2d");
      labelContainer = document.getElementById("label-container");
      for (let i = 0; i < maxPredictions; i++) { // and class labels
        labelContainer.appendChild(document.createElement("div"));
      }
    }

    async function loop(timestamp) {
      //stoppin condition for this loop with button
      //if statement with var loopstop = false  
      if (loopstop == false) {
        webcam.update(); // update the webcam frame
        await predict();
        window.requestAnimationFrame(loop);//recursively
      }

    }

    async function predict() {
      // Prediction #1: run input through posenet
      // estimatePose can take in an image, video or canvas html element
      const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
      // Prediction 2: run input through teachable machine classification model
      const prediction = await model.predict(posenetOutput);

      for (let i = 0; i < 2; i++) {
        const classPrediction =
          prediction[i].className + ": " + prediction[i].probability.toFixed(2);
        //2 decimal places
        labelContainer.childNodes[i].innerHTML = classPrediction;
        console.log(prediction[i].probability.toFixed(2))
      }

      // draw the poses
      drawPose(pose);
    }

    function drawPose(pose) {
      if (webcam.canvas) {
        ctx.drawImage(webcam.canvas, 0, 0);
        // draw the keypoints and skeleton
        if (pose) {
          const minPartConfidence = 0.5;
          tmPose.drawKeypoints(pose.keypoints, minPartConfidence, ctx);
          tmPose.drawSkeleton(pose.keypoints, minPartConfidence, ctx);
        }
      }
    }

  </script>
  <script type="text/javascript" src="/bootstrap/js/bootstrap.bundle.min.js"></script>


</body>

</html>