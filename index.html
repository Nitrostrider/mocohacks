<!DOCTYPE html>
<html>

<head>
  <title>Mocohocks Project</title>
  <link rel="stylesheet" href="/style.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark" style="background-color:#2b2e4a;">
    <div class="container">
      <a class="navbar-brand" style="font-size:25px;color: #ee7777" href="#">Project</a>
      <button style="border-style:none;" class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false"
        aria-label="Toggle navigation">
        <span style="border-color:pink;" class="fish navbar-toggler-icon">
        </span>
      </button>
      <div class="collapse justify-content-end navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-link" href="#section1">Machine</a>
          <a class="nav-link" href="#">What</a>
          <a class="nav-link" href="#">Why</a>
          <a class="nav-link" href="#">How</a>
        </div>
      </div>
    </div>
  </nav>
  <div style="height:60px"></div>

  <div class="container">
    <h1>Mocohacks Project</h1>
    <div class="row">
      <div class="col-md-6">
        <p>hello</p>
      </div>
  #section1 {
      <div class="col-md-6" style="background-color:red"> }
        <div>Teachable Machine Pose Model</div>
        <!--<input id="startBtn" type="button" value="Start(failure)" />-->
        <button onclick="init();loopstarter()">Start</button>
        <button onclick="loopstopper()">Stop</button>
        <!--<button id="stopBtn" type="button" onclick="">Stop</button>-->
        <div>
          <canvas style="height:200px; width:200px" id="canvas"></canvas>
        </div>
        <div id="label-container"></div>
      </div>
    </div>


  </div>

  <div class="container">
    <h1>Reaching New Heights</h1>
    <p>The term posture is in reference to the position of oneâ€™s body in a standing or sitting position. The spine
      consists of three natural curvatures which when aligned evenly distributes the weight between your feet. Good
      posture distributes this weight to prevent lopsidedness.</p>
    <p>- Nourishing proper posture form can</p>
    <ol>
      <li>Prevent stress from building on your spinal chords</li>
      <li>Decrease back pains and aches</li>
      <li>Servicable to aging</li>
      <li>Decrease the likelihood of headaches</li>
      <li>Improved Oxygen Flow</li>
    </ol>
    <p>As video meetings become more prevalent during this day and age, your virtual image becomes very important. Along
      with the various health benefits associated with good posture, this website will also assist your image on
      professional meetings online.
    </p>
  </div>






  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
  <script type="text/javascript">
    // More API functions here:
    // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/pose
    let loopstop = false;
    function loopstopper() {
      loopstop = true;
    }
    function loopstarter() {
      loopstop = false;
    }
    // the link to your model provided by Teachable Machine export panel
    const URL = "/my-pose-model/";
    let model, webcam, ctx, labelContainer, maxPredictions;

    /*var mixBtn = document.getElementById("startBtn");
    mixBtn.addEventListener("click", startTM);

    function startTM() {
      console.log("started");
      mixBtn.removeEventListener("click", startTM);
      mixBtn.addEventListener("click", stopTM);
      mixBtn.value = "Stop";
    }
    function stopTM() {
      console.log("stopped");
      mixBtn.removeEventListener("click", stopTM);
      mixBtn.addEventListener("click", startTM);
    }

    function hello() {
      var cow = 1;
      if (cow == 1) {
        console.log("d");
        init();
        return;
      } else {
        console.log("goodbye")
      }
    }*/


    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      // load the model and metadata
      // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
      // Note: the pose library adds a tmPose object to your window (window.tmPose)
      model = await tmPose.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      // Convenience function to setup a webcam
      const size = 200;
      const flip = true; // whether to flip the webcam
      webcam = new tmPose.Webcam(size, size, flip); // width, height, flip

      await webcam.setup(); // request access to the webcam
      await webcam.play();
      window.requestAnimationFrame(loop);

      // append/get elements to the DOM
      const canvas = document.getElementById("canvas");
      canvas.width = size; canvas.height = size;
      ctx = canvas.getContext("2d");
      labelContainer = document.getElementById("label-container");
      for (let i = 0; i < maxPredictions; i++) { // and class labels
        labelContainer.appendChild(document.createElement("div"));
      }
    }

    async function loop(timestamp) {
      //stoppin condition for this loop with button
      //if statement with var loopstop = false  
      if (loopstop == false) {
        webcam.update(); // update the webcam frame
        await predict();
        window.requestAnimationFrame(loop);//recursively
      }

    }

    async function predict() {
      // Prediction #1: run input through posenet
      // estimatePose can take in an image, video or canvas html element
      const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
      // Prediction 2: run input through teachable machine classification model
      const prediction = await model.predict(posenetOutput);

      for (let i = 0; i < 2; i++) {
        const classPrediction =
          prediction[i].className + ": " + prediction[i].probability.toFixed(2);
        //2 decimal places
        labelContainer.childNodes[i].innerHTML = classPrediction;
        console.log(prediction[i].probability.toFixed(2))
      }

      // draw the poses
      drawPose(pose);
    }

    function drawPose(pose) {
      if (webcam.canvas) {
        ctx.drawImage(webcam.canvas, 0, 0);
        // draw the keypoints and skeleton
        /*if (pose) {
          const minPartConfidence = 0.5;
          tmPose.drawKeypoints(pose.keypoints, minPartConfidence, ctx);
          tmPose.drawSkeleton(pose.keypoints, minPartConfidence, ctx);
        }*/
      }
    }

  </script>
  <script type="text/javascript" src="/bootstrap/js/bootstrap.bundle.min.js"></script>


</body>

</html>
